



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>tank.log &mdash; tk-core v0.18.88 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="tk-core v0.18.88 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
    <a href='http://developer.shotgunsoftware.com'>
    
        <img style='width: 191px;
                height: 60px; 
                margin: 2px;
                border-radius: 0px; 
                padding: 0px;' 
            src='../../_static/logo@2x.png'/>
    
    </a>
    

          
            <a href="../../index.html" class="icon icon-home"> tk-core
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../bootstrap.html">Deploy and management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core.html">Foundation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../platform.html">Apps, Engines and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../descriptor.html">Descriptor API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authentication.html">Authentication</a></li>
</ul>

            
          
       
    <div style='margin-top: 50px;
                margin-left: 10px;
                margin-right: 10px;
                padding: 10px; 
                color: #b3b3b3; 
                font-size: 70%;
                border-radius: 3px;
                background-color: #444;
                line-height: 18px;
                '>    
    <style>
        a.custom_post_menu { display: inline; 
                             padding: 0px; 
                             text-decoration: underline; }
    </style>

    <b>tk-core</b> v0.18.88.<br>
    
        This documentation is part of the Shotgun Pipeline Toolkit.
    
    For more information, please visit
    <a class=custom_post_menu href='https://support.shotgunsoftware.com/home'>Shotgun Support</a>.
    The code associated with this documentation can be found 
    <a class=custom_post_menu href='https://github.com/shotgunsoftware/tk-core'>here</a>.

    </div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">tk-core</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>tank.log</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tank.log</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2016 Shotgun Software Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the Shotgun Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the Shotgun Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Shotgun Software Inc.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Toolkit uses the standard python logging for its</span>
<span class="sd">log management. The :class:`LogManager` class below</span>
<span class="sd">acts as an interface that helps make it easy to access</span>
<span class="sd">and manage Toolkit logging.</span>


<span class="sd">Logging hierarchy</span>
<span class="sd">-----------------------------------</span>

<span class="sd">All Toolkit logging is written into a ``sgtk.*`` logging</span>
<span class="sd">namespace. This has been &quot;sealed&quot; so that log messages</span>
<span class="sd">from Toolkit do not propagate up to the root logger. This</span>
<span class="sd">is to ensure that Toolkit doesn&#39;t interfere with other logging</span>
<span class="sd">that has been already configured.</span>

<span class="sd">The following sub-hierarchies exist:</span>

<span class="sd">- Each app, engine and bundle provides access to logging and</span>
<span class="sd">  these log streams are collected and organized under the</span>
<span class="sd">  ``sgtk.env`` logging namespace. Below this level, messages</span>
<span class="sd">  are broken down further by environment, engine, etc.</span>

<span class="sd">- Logging from external tools and scripts is written to ``sgtk.ext``.</span>

<span class="sd">- All core logging is written to the ``sgtk.core`` logger.</span>

<span class="sd">Below is a simple log hierarchy to illustrate what this might look like in practice.</span>

<span class="sd">.. code-block:: text</span>

<span class="sd">    sgtk                                              Root point for all Toolkit logging</span>
<span class="sd">     |</span>
<span class="sd">     |- core                                          Root point for the Core API</span>
<span class="sd">     |   |</span>
<span class="sd">     |   |- descriptor                                Logging from core Modules</span>
<span class="sd">     |   |- path_cache</span>
<span class="sd">     |   |- hook</span>
<span class="sd">     |       |- create_folders                        Logging from a core hook</span>
<span class="sd">     |</span>
<span class="sd">     |- env                                           Logging from apps and engines</span>
<span class="sd">     |   |</span>
<span class="sd">     |   |- project                                   Toolkit Environment</span>
<span class="sd">     |       |</span>
<span class="sd">     |       |- tk-maya                               Toolkit Engine</span>
<span class="sd">     |             |</span>
<span class="sd">     |             |- startup                         Toolkit Engine Software Launcher</span>
<span class="sd">     |             |</span>
<span class="sd">     |             |- tk-multi-workfiles2             Toolkit App (or framework)</span>
<span class="sd">     |                  |</span>
<span class="sd">     |                  |- tkimp63c3b2d57f85          Toolkit Command Session</span>
<span class="sd">     |                  |   |</span>
<span class="sd">     |                  |   |- tk_multi_workfiles     Python hierarchy inside app&#39;s python folder</span>
<span class="sd">     |                  |       |</span>
<span class="sd">     |                  |       |- entity_tree</span>
<span class="sd">     |                  |</span>
<span class="sd">     |                  |</span>
<span class="sd">     |                  |</span>
<span class="sd">     |                  |- hook</span>
<span class="sd">     |                      |- scene_operations       Logging from a hook</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |- ext                                           Logging from associated external scripts</span>
<span class="sd">         |</span>
<span class="sd">         |- tank_cmd</span>


<span class="sd">Generating log messages in Toolkit</span>
<span class="sd">-----------------------------------</span>

<span class="sd">Generating log messages are done differently depending on your context.</span>
<span class="sd">Below are a series of examples and best practice recipes explaining how to best</span>
<span class="sd">apply logging to different scenarios.</span>


<span class="sd">Logging from within your App, Engine or Framework</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">Inside your app, a logger is available via :meth:`~sgtk.platform.Application.logger`.</span>
<span class="sd">Alternatively, you can also</span>
<span class="sd">use the legacy methods ``log_debug|error|info|...()``. This provides</span>
<span class="sd">a basic level of general logging.</span>

<span class="sd">For code inside the ``python`` folder, which has been imported via</span>
<span class="sd">Toolkit&#39;s :meth:`~sgtk.platform.Application.import_module()` method,</span>
<span class="sd">we recommend that you access a logger using the following method::</span>

<span class="sd">    # at the top of the file, include the following</span>
<span class="sd">    import sgtk</span>
<span class="sd">    logger = sgtk.platform.get_logger(__name__)</span>

<span class="sd">    def my_method():</span>
<span class="sd">        logger.debug(&quot;inside my code, i can log like this&quot;)</span>

<span class="sd">This logger will be grouped per invocation instance,</span>
<span class="sd">meaning that you can see for example which dialog UI</span>
<span class="sd">a particular collection of log messages comes from.</span>
<span class="sd">An invocation is typically associated with someone launching</span>
<span class="sd">the app from the Shotgun menu.</span>

<span class="sd">    .. note:: Because log messages are grouped per invocation,</span>
<span class="sd">              this makes it easy to for example generate log files</span>
<span class="sd">              for export or import sessions running as part of an</span>
<span class="sd">              app. It also makes it possible to create a log window</span>
<span class="sd">              which displays the logging associated with a particular</span>
<span class="sd">              app UI dialog.</span>

<span class="sd">Logging from scripts and other external locations</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">If you want to add standard Toolkit logging to a script, simply</span>
<span class="sd">use the following recipe::</span>

<span class="sd">    # at the top of the file, include the following</span>
<span class="sd">    import sgtk</span>
<span class="sd">    logger = sgtk.LogManager.get_logger(__name__)</span>

<span class="sd">    def my_method():</span>
<span class="sd">        logger.debug(&quot;inside my code, i can log like this&quot;)</span>

<span class="sd">All this logging will appear below the ``sgtk.ext`` logger.</span>

<span class="sd">Logging from inside the Core API</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">To emit log messages from inside the Toolkit Core API, use the following pattern::</span>

<span class="sd">    # at the top of the file, include the following</span>
<span class="sd">    import sgtk</span>
<span class="sd">    logger = sgtk.LogManager.get_logger(__name__)</span>

<span class="sd">    def my_method():</span>
<span class="sd">        logger.debug(&quot;inside my code, i can log like this&quot;)</span>



<span class="sd">Consuming log messages in Toolkit</span>
<span class="sd">-----------------------------------</span>

<span class="sd">Toolkit provides several ways to access the log information generated by</span>
<span class="sd">the various methods and recipes shown above.</span>

<span class="sd">The general approach is to attach one or several log handlers to the root</span>
<span class="sd">logging point of the hierarchy (``sgtk``). Each handler controls its own</span>
<span class="sd">logging resolution, e.g. how much log information to display. The toolkit</span>
<span class="sd">logging hierarchy itself is set to DEBUG resolution.</span>

<span class="sd">The Toolkit :class:`LogManager` provides a default set of logging methods</span>
<span class="sd">to help access log information.</span>


<span class="sd">Global debug</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">Toolkit has a concept of a global debug flag. This flag can be</span>
<span class="sd">enabled by setting the ``TK_DEBUG`` environment variable or</span>
<span class="sd">alternatively setting the :meth:`LogManager.global_debug` property.</span>

<span class="sd">All log handlers that have been created using the :class:`LogManager`</span>
<span class="sd">will be affected by the flag.</span>


<span class="sd">Backend file logging</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">Log information is automatically written to disk by the :class:`LogManager`.</span>
<span class="sd">The location to which log files are written can be accessed via the</span>
<span class="sd">:meth:`LogManager.log_folder` property. Backend file logging is normally</span>
<span class="sd">automatically enabled and end users do not need to worry about this.</span>
<span class="sd">If you want debug logging to be written to these files, enable the</span>
<span class="sd">global debug flag.</span>

<span class="sd">    .. note:: If you are writing a toolkit plugin, we recommend</span>
<span class="sd">              that you initialize logging early on in your code by</span>
<span class="sd">              calling :meth:`LogManager.initialize_base_file_handler`.</span>
<span class="sd">              This will ensure that all your logs are written to disk.</span>
<span class="sd">              If you omit this call, logging will automatically be</span>
<span class="sd">              started up as the engine is launched.</span>

<span class="sd">DCC Logging</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">Each toolkit engine integrates logging into the DCC. DCCs such as</span>
<span class="sd">Maya, Nuke or houdini traditionally have a console of some sort where</span>
<span class="sd">logging information typically should be dispatched.</span>

<span class="sd">Engine log output has traditionally been implemented by subclassing</span>
<span class="sd">the ``log_info``, ``log_error`` methods. In Core v0.18, a new and</span>
<span class="sd">improved logging platform is introduced and we recommend that engines</span>
<span class="sd">*do not* implement the ``log_xxx`` methods at all but instead implement</span>
<span class="sd">a single :meth:`~sgtk.platform.Engine._emit_log_message` method.</span>


<span class="sd">Standard Logging</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">If you want some sort of log output in addition to the logging an</span>
<span class="sd">engine provides, you can add standard toolkit handlers. These handlers</span>
<span class="sd">are created via the :meth:`LogManager.initialize_custom_handler` method.</span>

<span class="sd">All log handlers created or registered via this method will respond</span>
<span class="sd">to the global debug flag.</span>

<span class="sd">    .. note:: If you want a raw log output that is not affected</span>
<span class="sd">              by any changes to the global debug flag, we recommend that</span>
<span class="sd">              you manually create your log handler and attach it to</span>
<span class="sd">              the ``sgtk`` root logger.</span>

<span class="sd">Python provides a large number of log handlers as part of its standard library.</span>
<span class="sd">For more information, see https://docs.python.org/2/library/logging.handlers.html#module-logging.handlers</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">logging.handlers</span> <span class="kn">import</span> <span class="n">RotatingFileHandler</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">constants</span>


<div class="viewcode-block" id="LogManager"><a class="viewcode-back" href="../../utils.html#sgtk.log.LogManager">[docs]</a><span class="k">class</span> <span class="nc">LogManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main interface for logging in Toolkit.</span>

<span class="sd">    This class contains a series of methods to help standardize log output</span>
<span class="sd">    and access. Since Toolkit uses the standard python logging interface,</span>
<span class="sd">    you can manually configure and associate your logging if you like.</span>

<span class="sd">    .. note:: This is a singleton class, so every time you instantiate it,</span>
<span class="sd">              the same object is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># keeps track of the single instance of the class</span>
    <span class="n">__instance</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">class</span> <span class="nc">_SafeRotatingFileHandler</span><span class="p">(</span><span class="n">RotatingFileHandler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides all the functionality provided by Python&#39;s built-in RotatingFileHandler, but with a</span>
<span class="sd">        failsafe when an I/O error happens when doing the rollover. In that case, the failure to</span>
<span class="sd">        rename files will be ignored and the handler will keep writing to the current file. A message</span>
<span class="sd">        will also be logged at the debug level so the user is aware that something really bad just</span>
<span class="sd">        happened. Finally, the handler will not try to rollover in the future and the handler will keep</span>
<span class="sd">        appending to the current log file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">maxBytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">backupCount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            :param str filename: Name of of the log file.</span>
<span class="sd">            :param str mode: Mode to open the file, should be  &quot;w&quot; or &quot;a&quot;. Defaults to &quot;a&quot;</span>
<span class="sd">            :param int maxBytes: Maximum file size before rollover. By default, rollover never happens.</span>
<span class="sd">            :param int backupCount: Number of backups to make. Defaults to 0.</span>
<span class="sd">            :param encoding: Encoding to use when writing to the file. Defaults to None.</span>
<span class="sd">                File will be opened by default.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">RotatingFileHandler</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">maxBytes</span><span class="p">,</span> <span class="n">backupCount</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_rollover</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">def</span> <span class="nf">doRollover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Rename every backups so the current log can be promoted to backup number one.</span>

<span class="sd">            The new log file is empty. If this process fails due to any I/O error, rollover is</span>
<span class="sd">            deactivated for this handler and logs will be appended to the current log file indefinitely.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">temp_backup_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseFilename</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

            <span class="c1"># We need to close the file before renaming it (windows!)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="c1"># Before doing the rollover, check if the first file will fail at all.</span>
            <span class="c1"># If it does, then it is a good thing that we checked otherwise the last</span>
            <span class="c1"># backup would have been blown away before encountering the error.</span>

            <span class="c1"># Take the scenario where there&#39;s only one backup. This means that</span>
            <span class="c1"># doRollover would first delete the backup (.1) file so it can make</span>
            <span class="c1"># room for the main file to be renamed to .1. However, if the main file</span>
            <span class="c1"># can&#39;t be renamed, we&#39;ve effectively lost 50% of the logs we had, which</span>
            <span class="c1"># is not cool. Since most of the time only the first file will be locked,</span>
            <span class="c1"># we will try to rename it first. If that fails right away as expected,</span>
            <span class="c1"># we don&#39;t try any rollover and append to the current log file.</span>
            <span class="c1"># and raise the _disable_rollover flag.</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseFilename</span><span class="p">,</span> <span class="n">temp_backup_name</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># It failed, so we&#39;ll simply append from now on.</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot rotate log file &#39;</span><span class="si">%s</span><span class="s2">&#39;. Logging will continue to this file, &quot;</span>
                    <span class="s2">&quot;exceeding the specified maximum size&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseFilename</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle_rename_failure</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">disable_rollover</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Everything went well, so now simply move the log file back into place</span>
            <span class="c1"># so doRollover can do its work.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">temp_backup_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseFilename</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># For some reason we couldn&#39;t move the backup in its place.</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Unexpected issue while rotating log file &#39;</span><span class="si">%s</span><span class="s2">&#39;. Logging will continue to this file, &quot;</span>
                    <span class="s2">&quot;exceeding the specified maximum size&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseFilename</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span>
                <span class="p">)</span>
                <span class="c1"># The main log file doesn&#39;t exist anymore, so create a new file.</span>
                <span class="c1"># Don&#39;t disable the rollover, this has nothing to do with rollover</span>
                <span class="c1"># failing.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle_rename_failure</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Python 2.6 expects the file to be opened during rollover.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>

            <span class="c1"># Now, that we are back in the original state we were in,</span>
            <span class="c1"># were pretty confident that the rollover will work. However, due to</span>
            <span class="c1"># any number of reasons it could still fail. If it does, simply</span>
            <span class="c1"># disable rollover and append to the current log.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">RotatingFileHandler</span><span class="o">.</span><span class="n">doRollover</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># Something probably failed trying to rollover the backups,</span>
                <span class="c1"># since the code above proved that in theory the main log file</span>
                <span class="c1"># should be renamable. In any case, we didn&#39;t succeed in renaming,</span>
                <span class="c1"># so disable rollover and reopen the main log file in append mode.</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot rotate log file &#39;</span><span class="si">%s</span><span class="s2">&#39;. Logging will continue to this file, &quot;</span>
                    <span class="s2">&quot;exceeding the specified maximum size&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseFilename</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle_rename_failure</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">disable_rollover</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_handle_rename_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">disable_rollover</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Reopen the log file in the specific mode and optionally disable</span>
<span class="sd">            future rollover operations.</span>

<span class="sd">            :param str mode: Mode in which to reopen the main log file.</span>
<span class="sd">            :param bool disable_rollover: If True, rollover won&#39;t be possible in the</span>
<span class="sd">                future. Defaults to False.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Keep track that the rollover failed.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_rollover</span> <span class="o">=</span> <span class="n">disable_rollover</span>
            <span class="c1"># If the file has been closed, reopen it in append mode.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">shouldRollover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Return if the log files should rollover.</span>

<span class="sd">            If a rollover operation failed in the past this method will always return False.</span>

<span class="sd">            :param logging.Record record: record that is about to be written to the logs.</span>

<span class="sd">            :returns: True if rollover should happen, False otherwise.</span>
<span class="sd">            :rtype: bool</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disable_rollover</span> <span class="ow">and</span> <span class="n">RotatingFileHandler</span><span class="o">.</span><span class="n">shouldRollover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># note - this init isn&#39;t currently threadsafe.</span>
        <span class="c1">#</span>
        <span class="c1"># create the instance if it hasn&#39;t been created already</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__instance</span><span class="p">:</span>
            <span class="c1"># remember the instance so that no more are created</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">LogManager</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
                <span class="bp">cls</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

            <span class="c1"># a global and standard rotating log file handler</span>
            <span class="c1"># for writing generic toolkit logs to disk</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_std_file_handler</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_std_file_handler_log_file</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="c1"># collection of weak references to handlers</span>
            <span class="c1"># that were created via the log manager.</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_handlers</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># the root logger, created at code init</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">ROOT_LOGGER_NAME</span><span class="p">)</span>

            <span class="c1"># check the TK_DEBUG flag at startup</span>
            <span class="c1"># this controls the &quot;global debug&quot; state</span>
            <span class="c1"># in the log manager</span>
            <span class="k">if</span> <span class="n">constants</span><span class="o">.</span><span class="n">DEBUG_LOGGING_ENV_VAR</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> environment variable detected. Enabling debug logging.&quot;</span> <span class="o">%</span> <span class="n">constants</span><span class="o">.</span><span class="n">DEBUG_LOGGING_ENV_VAR</span>
                <span class="p">)</span>
                <span class="n">instance</span><span class="o">.</span><span class="n">_global_debug</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">instance</span><span class="o">.</span><span class="n">_global_debug</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="bp">cls</span><span class="o">.</span><span class="n">__instance</span> <span class="o">=</span> <span class="n">instance</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__instance</span>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="LogManager.get_logger"><a class="viewcode-back" href="../../utils.html#sgtk.log.LogManager.get_logger">[docs]</a>    <span class="k">def</span> <span class="nf">get_logger</span><span class="p">(</span><span class="n">log_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates standard logger objects for Toolkit.</span>

<span class="sd">        If you want to add standard toolkit logging to your code,</span>
<span class="sd">        the easiest way is to include the following at the top of</span>
<span class="sd">        your python file::</span>

<span class="sd">            import sgtk</span>
<span class="sd">            logger = sgtk.LogManager.get_logger(__name__)</span>

<span class="sd">        This will pick up the module hierarchy of your code and</span>
<span class="sd">        parent it under the standard Toolkit logger.</span>

<span class="sd">        .. note:: This method is useful if you are writing scripts, tools or wrappers.</span>
<span class="sd">                  If you are developing a Toolkit app, framework or engine,</span>
<span class="sd">                  you typically want to use :meth:`sgtk.platform.get_logger`</span>
<span class="sd">                  for your logging.</span>

<span class="sd">        .. note:: To output logging to screen or to a console,</span>
<span class="sd">                  we recommend using the :meth:`initialize_custom_handler`</span>
<span class="sd">                  convenience method.</span>

<span class="sd">        :param log_name: Name of logger to create. This name will be parented under</span>
<span class="sd">                         the sgtk namespace. If the name begins with ``tank.``, it will</span>
<span class="sd">                         be automatically replaced with ``sgtk.``.</span>
<span class="sd">        :returns: Standard python logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">log_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;tank.&quot;</span><span class="p">):</span>
            <span class="c1"># old style import of core</span>
            <span class="c1">#</span>
            <span class="c1"># this will be parented under sgtk.core.xxx</span>
            <span class="c1">#</span>
            <span class="n">log_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.core.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">ROOT_LOGGER_NAME</span><span class="p">,</span> <span class="n">log_name</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
        <span class="k">elif</span> <span class="n">log_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sgtk.&quot;</span><span class="p">):</span>
            <span class="c1"># new style import of core</span>
            <span class="c1">#</span>
            <span class="c1"># this will be parented under sgtk.core.xxx</span>
            <span class="c1">#</span>
            <span class="n">log_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.core.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">ROOT_LOGGER_NAME</span><span class="p">,</span> <span class="n">log_name</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
        <span class="k">elif</span> <span class="n">log_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;env.&quot;</span><span class="p">):</span>
            <span class="c1"># engine logging</span>
            <span class="c1">#</span>
            <span class="c1"># this will be parented under sgtk.env.xxx</span>
            <span class="c1"># for example sgtk.env.asset.tk-maya</span>
            <span class="c1">#</span>

            <span class="n">log_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">ROOT_LOGGER_NAME</span><span class="p">,</span> <span class="n">log_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># some external script or tool</span>
            <span class="n">log_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.ext.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">ROOT_LOGGER_NAME</span><span class="p">,</span> <span class="n">log_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">log_name</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="LogManager.log_timing"><a class="viewcode-back" href="../../utils.html#sgtk.log.LogManager.log_timing">[docs]</a>    <span class="k">def</span> <span class="nf">log_timing</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decorator that times and logs the execution of a method.</span>

<span class="sd">        Sometimes it is useful to log runtime statistics about</span>
<span class="sd">        how long time a certain method takes to execute. In the</span>
<span class="sd">        case of Toolkit, it is particularly helpful when debugging</span>
<span class="sd">        issues to do with I/O or cloud connectivity.</span>

<span class="sd">        If you have a method that for example connects to Shotgun to</span>
<span class="sd">        retrieve data, you can decorate it::</span>

<span class="sd">            @sgtk.LogManager.log_timing</span>
<span class="sd">            def my_shotgun_publish_method():</span>
<span class="sd">                &#39;&#39;&#39;</span>
<span class="sd">                Publishes lots of files to Shotgun</span>
<span class="sd">                &#39;&#39;&#39;</span>
<span class="sd">                # shotgun code here</span>

<span class="sd">        In the debug logs, timings will be written to the</span>
<span class="sd">        ``sgtk.stopwatch`` logger::</span>

<span class="sd">            [DEBUG sgtk.stopwatch.module] my_shotgun_publish_method: 0.633s</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">time_before</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">time_spent</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time_before</span>
                <span class="c1"># log to special timing logger</span>
                <span class="n">timing_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">PROFILING_LOG_CHANNEL</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__module__</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">timing_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%f</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">time_spent</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span>
        <span class="k">return</span> <span class="n">wrapper</span></div>



    <span class="k">def</span> <span class="nf">_set_global_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the state of the global debug in toolkit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_global_debug</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_debug</span><span class="p">:</span>
            <span class="n">new_log_level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Disabling debug logging.&quot;</span><span class="p">)</span>
            <span class="n">new_log_level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span>

        <span class="c1"># process handlers</span>
        <span class="k">for</span> <span class="n">handler_weak_ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">handler_weak_ref</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">handler</span><span class="p">:</span>
                <span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">new_log_level</span><span class="p">)</span>

        <span class="c1"># process backdoor logger</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_file_handler</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">new_log_level</span><span class="p">)</span>

        <span class="c1"># log notifications</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_debug</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Debug logging enabled. To permanently enable it, &quot;</span>
                <span class="s2">&quot;set the </span><span class="si">%s</span><span class="s2"> environment variable.&quot;</span> <span class="o">%</span> <span class="n">constants</span><span class="o">.</span><span class="n">DEBUG_LOGGING_ENV_VAR</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_global_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Controls the global debug flag in toolkit. Toggling this</span>
<span class="sd">        flag will affect all log handlers that have been created</span>
<span class="sd">        via :meth:`initialize_custom_handler`.</span>

<span class="sd">        .. note:: Debug logging is off by default.</span>
<span class="sd">                  If you want to permanently enable debug logging,</span>
<span class="sd">                  set the environment variable ``TK_DEBUG``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_global_debug</span>

    <span class="n">global_debug</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_global_debug</span><span class="p">,</span> <span class="n">_set_global_debug</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">log_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The folder where log files generated by :meth:`initialize_base_file_handler` are stored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># avoid cyclic references</span>
        <span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">LocalFileStorageManager</span>
        <span class="k">return</span> <span class="n">LocalFileStorageManager</span><span class="o">.</span><span class="n">get_global_root</span><span class="p">(</span><span class="n">LocalFileStorageManager</span><span class="o">.</span><span class="n">LOGGING</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root_logger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the root logger for Toolkit.</span>

<span class="sd">        .. note:: If you want to add a custom logging handler to the root logger,</span>
<span class="sd">                  we recommend using the :meth:`initialize_custom_handler` method.</span>

<span class="sd">        .. warning:: The root logger logs down to a debug resolution by default.</span>
<span class="sd">                     Do not change the output level of logger as this will have</span>
<span class="sd">                     a global effect. If you are connecting a logging handler</span>
<span class="sd">                     and want to limit the stream of messages that are being</span>
<span class="sd">                     emitted, instead adjust the logging level of the handler.</span>

<span class="sd">        :return: log object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root_logger</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">base_file_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The base file handler that is used to write log files to disk</span>
<span class="sd">        in a default location, or None if not defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler</span>

<div class="viewcode-block" id="LogManager.initialize_custom_handler"><a class="viewcode-back" href="../../utils.html#sgtk.log.LogManager.initialize_custom_handler">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_custom_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience method that initializes a log handler</span>
<span class="sd">        and attaches it to the toolkit logging root.</span>

<span class="sd">        .. note:: If you want to display log messages inside a DCC,</span>
<span class="sd">                  implement :meth:`~sgtk.platform.Engine._emit_log_message`.</span>

<span class="sd">        .. note:: If :meth:`global_debug` is set to True, the handler created</span>
<span class="sd">                  will be set to debug level, otherwise it will be set to info level.</span>
<span class="sd">                  Furthermore, the log handler will automatically adjust its log</span>
<span class="sd">                  level whenever the global debug flag changes its state.</span>

<span class="sd">        Calling this without parameters will generate a standard</span>
<span class="sd">        stream based logging handler that logs to stderr::</span>

<span class="sd">            # start logging to stderr</span>
<span class="sd">            import sgtk.LogManager</span>
<span class="sd">            LogManager().initialize_custom_handler()</span>

<span class="sd">        If you want to log to a file instead, create a log handler</span>
<span class="sd">        and pass that to the method::</span>

<span class="sd">            handler = logging.FileHandler(&quot;/tmp/toolkit.log)</span>
<span class="sd">            LogManager().initialize_custom_handler(handler)</span>

<span class="sd">        The log handler will be configured to output its messages</span>
<span class="sd">        in a standard fashion.</span>

<span class="sd">        :param handler: Logging handler to connect with the toolkit logger.</span>
<span class="sd">                        If not passed, a standard stream handler will be created.</span>
<span class="sd">        :return: The configured log handler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>

            <span class="c1"># example: [DEBUG tank.log] message message</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
                <span class="s2">&quot;[</span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(name)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_root_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_debug</span><span class="p">:</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

        <span class="c1"># add it to our list of handlers, but as a</span>
        <span class="c1"># weak reference so that it can be destroyed</span>
        <span class="c1"># elsewhere (e.g. at engine shutdown)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">handler</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">handler</span></div>

<div class="viewcode-block" id="LogManager.uninitialize_base_file_handler"><a class="viewcode-back" href="../../utils.html#sgtk.log.LogManager.uninitialize_base_file_handler">[docs]</a>    <span class="k">def</span> <span class="nf">uninitialize_base_file_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uninitialize base file handler created with :meth:`initialize_base_file_handler`.</span>

<span class="sd">        :returns: The path to the previous log file that is being switched away from,</span>
<span class="sd">                  None if no base logger was previously active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">base_log_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler_log_file</span>

        <span class="c1"># there is a log handler, so terminate it</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Tearing down existing log handler &#39;</span><span class="si">%s</span><span class="s2">&#39; (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">base_log_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler_log_file</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># return the previous base log file path.</span>
        <span class="k">return</span> <span class="n">base_log_file</span></div>

<div class="viewcode-block" id="LogManager.initialize_base_file_handler"><a class="viewcode-back" href="../../utils.html#sgtk.log.LogManager.initialize_base_file_handler">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_base_file_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a file handler and attach it to the stgk base logger.</span>
<span class="sd">        This will write a rotating log file to disk in a standard</span>
<span class="sd">        location and will capture all log messages passed through</span>
<span class="sd">        the log hierarchy.</span>

<span class="sd">        .. note:: Files will be written into the location on disk</span>
<span class="sd">                  defined by :meth:`log_folder`.</span>

<span class="sd">        When you start an engine via the :meth:`sgtk.platform.start_engine` method,</span>
<span class="sd">        a file handler will automatically be created if one doesn&#39;t already exist.</span>

<span class="sd">        If you are manually launching toolkit, we recommend that you call</span>
<span class="sd">        this method to initialize logging to file early on in your setup.</span>
<span class="sd">        Calling it multiple times will not result in the information being</span>
<span class="sd">        written to multiple different files - only one file logger can</span>
<span class="sd">        exist per session.</span>

<span class="sd">        :param log_name: Name of logger to create. This will form the</span>
<span class="sd">                         filename of the log file. The ``.log`` will be suffixed.</span>

<span class="sd">        :returns: The path to the previous log file that is being switched away from,</span>
<span class="sd">                  None if no base logger was previously active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># avoid cyclic references</span>
        <span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">filesystem</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_base_file_handler_from_path</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_folder</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.log&quot;</span> <span class="o">%</span> <span class="n">filesystem</span><span class="o">.</span><span class="n">create_valid_filename</span><span class="p">(</span><span class="n">log_name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="LogManager.initialize_base_file_handler_from_path"><a class="viewcode-back" href="../../utils.html#sgtk.log.LogManager.initialize_base_file_handler_from_path">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_base_file_handler_from_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a file handler and attach it to the sgtk base logger.</span>

<span class="sd">        This method is there for legacy Toolkit applications and shouldn&#39;t be used. Use</span>
<span class="sd">        ``initialize_base_file_handler`` instead.</span>

<span class="sd">        :param log_file: Path of the file to write the logs to.</span>

<span class="sd">        :returns: The path to the previous log file that is being switched away from,</span>
<span class="sd">                  None if no base logger was previously active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># shut down any previous logger</span>
        <span class="n">previous_log_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uninitialize_base_file_handler</span><span class="p">()</span>

        <span class="n">log_folder</span><span class="p">,</span> <span class="n">log_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span>
        <span class="n">log_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">log_file_name</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Switching file based std logger from &#39;</span><span class="si">%s</span><span class="s2">&#39; to &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="n">previous_log_file</span><span class="p">,</span> <span class="n">log_file</span><span class="p">)</span>

        <span class="c1"># store new log name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler_log_file</span> <span class="o">=</span> <span class="n">log_file</span>

        <span class="c1"># avoid cyclic references</span>
        <span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">filesystem</span>

        <span class="c1"># set up logging root folder</span>
        <span class="n">filesystem</span><span class="o">.</span><span class="n">ensure_folder_exists</span><span class="p">(</span><span class="n">log_folder</span><span class="p">)</span>

        <span class="c1"># create a rotating log file with a max size of 5 megs -</span>
        <span class="c1"># this should make all log files easily attachable to support tickets.</span>

        <span class="c1"># Python 2.5s implementation is way different that 2.6 and 2.7 and as such we can&#39;t</span>
        <span class="c1"># as easily support it for safe rotation.</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="n">handler_factory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SafeRotatingFileHandler</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">handler_factory</span> <span class="o">=</span> <span class="n">RotatingFileHandler</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler</span> <span class="o">=</span> <span class="n">handler_factory</span><span class="p">(</span>
            <span class="n">log_file</span><span class="p">,</span>
            <span class="n">maxBytes</span><span class="o">=</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># 5 MiB</span>
            <span class="n">backupCount</span><span class="o">=</span><span class="mi">1</span>          <span class="c1"># Need at least one backup in order to rotate</span>
        <span class="p">)</span>

        <span class="c1"># set the level based on global debug flag</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

        <span class="c1"># Set up formatter. Example:</span>
        <span class="c1"># 2016-04-25 08:56:12,413 [44862 DEBUG tank.log] message message</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> [</span><span class="si">%(process)d</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(name)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_std_file_handler</span><span class="p">)</span>

        <span class="c1"># log the fact that we set up the log file :)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Writing to standard log file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">log_file</span><span class="p">)</span>

        <span class="c1"># return previous log name</span>
        <span class="k">return</span> <span class="n">previous_log_file</span></div></div>

<span class="c1"># the logger for logging messages from this file :)</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">LogManager</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># initialize toolkit logging</span>
<span class="c1">#</span>
<span class="c1"># retrieve top most logger in the sgtk hierarchy</span>
<span class="n">sgtk_root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">ROOT_LOGGER_NAME</span><span class="p">)</span>
<span class="c1"># &#39;cap it&#39; so that log messages don&#39;t propagate</span>
<span class="c1"># further upwards in the hierarchy. This is to avoid</span>
<span class="c1"># log message spilling over into other loggers; if you</span>
<span class="c1"># want to receive toolkit log messages, you have to</span>
<span class="c1"># explicitly attach a log handler to the sgtk top level</span>
<span class="c1"># logger (or any of its child loggers).</span>
<span class="n">sgtk_root_logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="bp">False</span>
<span class="c1"># The top level logger object has its message throughput</span>
<span class="c1"># level set to DEBUG by default.</span>
<span class="c1"># this should not be changed, but any filtering</span>
<span class="c1"># should happen via log handlers</span>
<span class="n">sgtk_root_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># create a &#39;nop&#39; log handler to be attached.</span>
<span class="c1"># this is to avoid warnings being reported that</span>
<span class="c1"># logging is missing.</span>
<span class="c1">#</span>
<span class="k">class</span> <span class="nc">NullHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Handler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="k">pass</span>
<span class="c1"># and add it to the logger</span>
<span class="n">sgtk_root_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">NullHandler</span><span class="p">())</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Autodesk.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'v0.18.88',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2114792-1', 'auto');
  ga('send', 'pageview');
</script>



</body>
</html>