# Copyright (c) 2017 Shotgun Software Inc.
#
# CONFIDENTIAL AND PROPRIETARY
#
# This work is provided "AS IS" and subject to the Shotgun Pipeline Toolkit
# Source Code License included in this distribution package. See LICENSE.
# By accessing, using, copying or modifying this work you indicate your
# agreement to the Shotgun Pipeline Toolkit Source Code License. All rights
# not expressly granted therein are reserved by Shotgun Software Inc.

# travis-ci.org CI unit tests integration configuration file.

language: python

matrix:
  include:
  - python: "2.7"
    # When set to 1, tests/run_travis.sh will only compile the sources using python -m compileall
    env: SHOTGUN_COMPILE_ONLY=0 QT_QPA_PLATFORM=offscreen
  - python: "3.6"
    # We do not support Python 3 for the moment, but we will be compilable at the very least.
    env: SHOTGUN_COMPILE_ONLY=1

install:
  - pip install -r tests/ci_requirements.txt
  # PySide is tricky to install and run. Let's get a wheel from someone who already compiled it for
  # Travis.
  - sudo apt-get install libqt4-dev
  - pip install PySide==1.2.2 --no-index --find-links https://parkin.github.io/python-wheelhouse/;
  # Travis CI servers use virtualenvs, so we need to finish the install by the following
  - python ~/virtualenv/python${TRAVIS_PYTHON_VERSION}/bin/pyside_postinstall.py -install
  # Now we need to start the X server...
  export DISPLAY=:99.0
  sh -e /etc/init.d/xvfb start
  sleep 3

# command to run tests
script: tests/run_travis.sh
after_success: coveralls